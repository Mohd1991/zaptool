<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe - Online & Offline</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            padding: 20px;
            color: white;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #ff5252, #4fc3f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            box-shadow: 0 0 15px rgba(106, 17, 203, 0.5);
        }
        
        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(79, 195, 247, 0.5);
        }
        
        .mode-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #4fc3f7;
        }
        
        .mode-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .mode-description {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .lobby {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .lobby-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .lobby-id {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
            font-family: monospace;
            font-size: 1.1rem;
        }
        
        .players-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            width: 140px;
            transition: all 0.3s ease;
        }
        
        .player-card.you {
            border: 2px solid #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.5);
        }
        
        .player-card.waiting {
            opacity: 0.6;
        }
        
        .player-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .player-name {
            font-size: 1.1rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-status {
            font-size: 0.8rem;
            color: #4caf50;
        }
        
        .game-board-container {
            display: none;
            margin-bottom: 30px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .player-marker {
            font-size: 1.5rem;
        }
        
        .turn-indicator {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            max-width: 350px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
        }
        
        .cell {
            aspect-ratio: 1/1;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .cell:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }
        
        .cell.x {
            color: #ff5252;
        }
        
        .cell.o {
            color: #4fc3f7;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #ff5252, #ff7675);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 25px;
            border-radius: 15px;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        .modal-btn {
            padding: 8px 16px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        .modal-btn-primary {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            color: white;
        }
        
        .modal-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .searching-message {
            text-align: center;
            padding: 15px;
            font-size: 1rem;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #4fc3f7;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid #4caf50;
        }
        
        .notification.error {
            border-left: 4px solid #f44336;
        }
        
        .notification.info {
            border-left: 4px solid #4fc3f7;
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .difficulty-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .offline-player-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .player-select-btn {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-weight: 600;
        }
        
        .player-select-btn.active {
            background: linear-gradient(45deg, #ff5252, #ff7675);
            box-shadow: 0 0 15px rgba(255, 82, 82, 0.5);
        }
        
        .player-select-btn:nth-child(2).active {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.5);
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">
        <div class="notification-content"></div>
    </div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-gamepad"></i> TIC TAC TOE</h1>
        </header>
        
        <div class="mode-selector">
            <button class="mode-btn active" id="online-mode-btn">Online</button>
            <button class="mode-btn" id="offline-mode-btn">Offline</button>
        </div>
        
        <!-- Online Mode Content -->
        <div id="online-content">
            <div class="game-modes" id="game-modes">
                <div class="mode-card" id="create-room">
                    <div class="mode-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3 class="mode-title">Create Room</h3>
                    <p class="mode-description">Create a private room and invite friends</p>
                    <button class="btn-success">
                        <i class="fas fa-plus"></i> Create
                    </button>
                </div>
                
                <div class="mode-card" id="join-room">
                    <div class="mode-icon">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <h3 class="mode-title">Join Room</h3>
                    <p class="mode-description">Join with a room ID</p>
                    <button class="btn-secondary">
                        <i class="fas fa-sign-in-alt"></i> Join
                    </button>
                </div>
            </div>
            
            <div class="lobby" id="lobby">
                <div class="lobby-header">
                    <h2>Game Lobby</h2>
                    <div class="lobby-id">Room ID: <span id="room-id">XXXXXX</span></div>
                </div>
                
                <p>Share this room ID with your friend:</p>
                
                <div class="players-container">
                    <div class="player-card you">
                        <div class="player-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="player-name" id="lobby-player1">You</div>
                        <div class="player-status">Ready</div>
                    </div>
                    
                    <div class="player-card waiting">
                        <div class="player-icon">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="player-name" id="lobby-player2">Waiting...</div>
                        <div class="player-status">Connecting</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn-secondary" id="copy-room-id">
                        <i class="fas fa-copy"></i> Copy ID
                    </button>
                    <button class="btn-success" id="start-game" disabled>
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="btn-secondary" id="leave-lobby">
                        <i class="fas fa-sign-out-alt"></i> Leave
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Offline Mode Content -->
        <div id="offline-content" style="display: none;">
            <div class="game-modes">
                <div class="mode-card" id="vs-human">
                    <div class="mode-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="mode-title">2 Player</h3>
                    <p class="mode-description">Play against a friend on the same device</p>
                    <button class="btn-primary" id="start-vs-human">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                </div>
                
                <div class="mode-card" id="vs-computer">
                    <div class="mode-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 class="mode-title">VS Computer</h3>
                    <p class="mode-description">Play against AI with different difficulty levels</p>
                    <button class="btn-primary" id="start-vs-computer">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                </div>
            </div>
            
            <div id="vs-computer-settings" style="display: none;">
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-difficulty="easy">Easy</button>
                    <button class="difficulty-btn" data-difficulty="medium">Medium</button>
                    <button class="difficulty-btn" data-difficulty="hard">Hard</button>
                </div>
                
                <div class="offline-player-selector">
                    <button class="player-select-btn active" data-mark="X">
                        <i class="fas fa-times"></i> Play as X
                    </button>
                    <button class="player-select-btn" data-mark="O">
                        <i class="far fa-circle"></i> Play as O
                    </button>
                </div>
                
                <div class="controls">
                    <button class="btn-primary" id="start-ai-game">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    <button class="btn-secondary" id="back-to-offline">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Board (shared for both modes) -->
        <div class="game-board-container" id="game-container">
            <div class="game-info">
                <div class="player-info">
                    <span class="player-marker x">X</span>
                    <span id="player-x-name">Player X</span>
                </div>
                
                <div class="turn-indicator" id="turn-indicator">Your Turn!</div>
                
                <div class="player-info">
                    <span class="player-marker o">O</span>
                    <span id="player-o-name">Player O</span>
                </div>
            </div>
            
            <div class="game-board" id="game-board">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
            
            <div class="controls">
                <button class="btn-secondary" id="rematch-btn">
                    <i class="fas fa-redo"></i> Rematch
                </button>
                <button class="btn-secondary" id="leave-game">
                    <i class="fas fa-sign-out-alt"></i> Main Menu
                </button>
            </div>
        </div>
    </div>
    
    <!-- Join Room Modal -->
    <div class="modal" id="join-room-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Join Room</div>
                <button class="close-modal" id="close-join-modal">&times;</button>
            </div>
            <input type="text" class="modal-input" id="room-id-input" placeholder="Enter Room ID">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" id="cancel-join">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="confirm-join">Join</button>
            </div>
        </div>
    </div>
    
    <!-- Searching Modal -->
    <div class="modal" id="searching-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Joining Room</div>
            </div>
            <div class="searching-message">
                <div class="spinner"></div>
                <p id="searching-text">Connecting to room...</p>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const onlineModeBtn = document.getElementById('online-mode-btn');
            const offlineModeBtn = document.getElementById('offline-mode-btn');
            const onlineContent = document.getElementById('online-content');
            const offlineContent = document.getElementById('offline-content');
            const gameModes = document.getElementById('game-modes');
            const lobby = document.getElementById('lobby');
            const gameContainer = document.getElementById('game-container');
            const notification = document.getElementById('notification');
            
            // Mode switching
            onlineModeBtn.addEventListener('click', () => {
                onlineModeBtn.classList.add('active');
                offlineModeBtn.classList.remove('active');
                onlineContent.style.display = 'block';
                offlineContent.style.display = 'none';
                resetToMainMenu();
            });
            
            offlineModeBtn.addEventListener('click', () => {
                offlineModeBtn.classList.add('active');
                onlineModeBtn.classList.remove('active');
                offlineContent.style.display = 'block';
                onlineContent.style.display = 'none';
                resetToMainMenu();
            });
            
            // Game state
            let gameActive = false;
            let currentPlayer = 'X';
            let gameBoard = ['', '', '', '', '', '', '', '', ''];
            let playerMark = 'X';
            let opponentName = 'Opponent';
            let isHost = false;
            let roomId = '';
            let gameMode = ''; // 'online', 'vs-human', 'vs-computer'
            let difficulty = 'easy';
            let isPlayerTurn = true;
            
            // Generate a random player name
            const playerName = "Player_" + Math.floor(Math.random() * 1000);
            document.getElementById('lobby-player1').textContent = playerName;
            document.getElementById('player-x-name').textContent = playerName;
            
            // Show notification
            function showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const content = notification.querySelector('.notification-content');
                content.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Generate a random room ID
            function generateRoomId() {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                let result = '';
                for (let i = 0; i < 6; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }
            
            // Reset to main menu
            function resetToMainMenu() {
                gameContainer.style.display = 'none';
                lobby.style.display = 'none';
                gameModes.style.display = 'grid';
                document.getElementById('vs-computer-settings').style.display = 'none';
            }
            
            // ONLINE MODE FUNCTIONS
            
            // Create room
            document.querySelector('#create-room button').addEventListener('click', () => {
                isHost = true;
                gameMode = 'online';
                roomId = generateRoomId();
                document.getElementById('room-id').textContent = roomId;
                
                gameModes.style.display = 'none';
                lobby.style.display = 'block';
                showNotification(`Room ${roomId} created!`, 'success');
                
                // Simulate opponent joining after delay
                setTimeout(() => {
                    opponentName = "Player_" + Math.floor(Math.random() * 1000);
                    document.getElementById('lobby-player2').textContent = opponentName;
                    document.querySelector('.player-card.waiting .player-status').textContent = 'Ready';
                    document.getElementById('start-game').disabled = false;
                    showNotification(`${opponentName} joined the room!`, 'success');
                }, 2000);
            });
            
            // Join room modal
            const joinRoomModal = document.getElementById('join-room-modal');
            const joinRoomBtn = document.querySelector('#join-room button');
            const closeJoinModal = document.getElementById('close-join-modal');
            const cancelJoin = document.getElementById('cancel-join');
            const confirmJoin = document.getElementById('confirm-join');
            const roomIdInput = document.getElementById('room-id-input');
            const searchingModal = document.getElementById('searching-modal');
            const searchingText = document.getElementById('searching-text');
            
            // Show join room modal
            joinRoomBtn.addEventListener('click', () => {
                joinRoomModal.style.display = 'flex';
                roomIdInput.focus();
            });
            
            // Close join room modal
            closeJoinModal.addEventListener('click', () => {
                joinRoomModal.style.display = 'none';
            });
            
            cancelJoin.addEventListener('click', () => {
                joinRoomModal.style.display = 'none';
            });
            
            // Confirm join room
            confirmJoin.addEventListener('click', () => {
                const enteredRoomId = roomIdInput.value.trim().toUpperCase();
                
                if (enteredRoomId.length !== 6) {
                    showNotification('Room ID must be 6 characters', 'error');
                    return;
                }
                
                gameMode = 'online';
                joinRoomModal.style.display = 'none';
                searchingModal.style.display = 'flex';
                searchingText.textContent = "Connecting to room...";
                
                // Simulate connecting to room (2 seconds)
                setTimeout(() => {
                    // 80% chance of successful connection
                    if (Math.random() < 0.8) {
                        searchingText.textContent = "Found room! Joining...";
                        
                        // Successfully joined
                        setTimeout(() => {
                            searchingModal.style.display = 'none';
                            gameModes.style.display = 'none';
                            lobby.style.display = 'block';
                            
                            isHost = false;
                            roomId = enteredRoomId;
                            document.getElementById('room-id').textContent = roomId;
                            document.getElementById('lobby-player1').textContent = playerName;
                            document.getElementById('lobby-player2').textContent = "Host";
                            document.querySelector('.player-card.waiting .player-status').textContent = 'Ready';
                            document.getElementById('start-game').disabled = false;
                            
                            showNotification(`Joined room ${roomId}`, 'success');
                        }, 1500);
                    } else {
                        // Connection failed
                        searchingText.textContent = `Room ${enteredRoomId} not found`;
                        setTimeout(() => {
                            searchingModal.style.display = 'none';
                            joinRoomModal.style.display = 'flex';
                            showNotification('Could not find room', 'error');
                        }, 2000);
                    }
                }, 2000);
            });
            
            // Copy room ID
            document.getElementById('copy-room-id').addEventListener('click', () => {
                navigator.clipboard.writeText(roomId);
                showNotification('Room ID copied!', 'success');
            });
            
            // Start game (online)
            document.getElementById('start-game').addEventListener('click', () => {
                lobby.style.display = 'none';
                gameContainer.style.display = 'block';
                
                if (isHost) {
                    playerMark = 'X';
                    document.getElementById('player-o-name').textContent = opponentName;
                    showNotification('Game started! You are X', 'success');
                } else {
                    playerMark = 'O';
                    document.getElementById('player-x-name').textContent = "Host";
                    showNotification('Game started! You are O', 'success');
                }
                
                startGame();
            });
            
            // Leave lobby
            document.getElementById('leave-lobby').addEventListener('click', () => {
                lobby.style.display = 'none';
                gameModes.style.display = 'grid';
                showNotification('Left the lobby', 'info');
            });
            
            // OFFLINE MODE FUNCTIONS
            
            // VS Human mode
            document.getElementById('start-vs-human').addEventListener('click', () => {
                gameMode = 'vs-human';
                playerMark = 'X';
                document.getElementById('player-x-name').textContent = "Player 1 (X)";
                document.getElementById('player-o-name').textContent = "Player 2 (O)";
                
                gameModes.style.display = 'none';
                gameContainer.style.display = 'block';
                showNotification('2 Player game started!', 'success');
                
                startGame();
            });
            
            // VS Computer mode setup
            document.getElementById('start-vs-computer').addEventListener('click', () => {
                gameModes.style.display = 'none';
                document.getElementById('vs-computer-settings').style.display = 'block';
            });
            
            // Difficulty selection
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    difficulty = btn.getAttribute('data-difficulty');
                });
            });
            
            // Player selection (X/O)
            document.querySelectorAll('.player-select-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.player-select-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    playerMark = btn.getAttribute('data-mark');
                });
            });
            
            // Back to offline menu
            document.getElementById('back-to-offline').addEventListener('click', () => {
                document.getElementById('vs-computer-settings').style.display = 'none';
                gameModes.style.display = 'grid';
            });
            
            // Start VS Computer game
            document.getElementById('start-ai-game').addEventListener('click', () => {
                gameMode = 'vs-computer';
                document.getElementById('player-x-name').textContent = 
                    playerMark === 'X' ? "You (X)" : "Computer (X)";
                document.getElementById('player-o-name').textContent = 
                    playerMark === 'O' ? "You (O)" : "Computer (O)";
                
                document.getElementById('vs-computer-settings').style.display = 'none';
                gameContainer.style.display = 'block';
                showNotification(`Game started! ${difficulty} difficulty`, 'success');
                
                startGame();
                
                // If computer goes first, make its move
                if (playerMark !== 'X') {
                    isPlayerTurn = false;
                    setTimeout(makeComputerMove, 800);
                }
            });
            
            // SHARED GAME FUNCTIONS
            
            // Leave game
            document.getElementById('leave-game').addEventListener('click', () => {
                resetToMainMenu();
                showNotification('Returned to main menu', 'info');
            });
            
            // Rematch
            document.getElementById('rematch-btn').addEventListener('click', () => {
                resetGame();
                showNotification('Starting rematch...', 'info');
                
                if (gameMode === 'vs-computer' && playerMark !== 'X') {
                    isPlayerTurn = false;
                    setTimeout(makeComputerMove, 800);
                }
            });
            
            // Game functions
            function startGame() {
                resetGame();
                gameActive = true;
                isPlayerTurn = true;
                
                // Set starting player
                currentPlayer = 'X';
                
                // Update UI
                updateTurnIndicator();
                
                // Add event listeners to cells
                const cells = document.querySelectorAll('.cell');
                cells.forEach(cell => {
                    cell.addEventListener('click', handleCellClick);
                });
            }
            
            function handleCellClick(e) {
                if (!gameActive) return;
                
                // In VS Computer mode, check if it's player's turn
                if (gameMode === 'vs-computer' && !isPlayerTurn) return;
                
                const cell = e.target;
                const index = parseInt(cell.getAttribute('data-index'));
                
                // Check if cell is empty
                if (gameBoard[index] !== '') return;
                
                // Update game state
                gameBoard[index] = currentPlayer;
                cell.textContent = currentPlayer;
                cell.classList.add(currentPlayer.toLowerCase());
                
                // Check for win or draw
                if (checkWin()) {
                    endGame(false);
                    return;
                }
                
                if (checkDraw()) {
                    endGame(true);
                    return;
                }
                
                // Switch player
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                updateTurnIndicator();
                
                // Handle next move based on game mode
                if (gameMode === 'online' && !isHost && currentPlayer !== playerMark) {
                    // In online guest mode, wait for host to make move
                    // (In a real implementation, this would wait for server update)
                } 
                else if (gameMode === 'vs-computer') {
                    isPlayerTurn = !isPlayerTurn;
                    if (!isPlayerTurn) {
                        setTimeout(makeComputerMove, 800);
                    }
                }
            }
            
            function makeComputerMove() {
                if (!gameActive) return;
                
                let move;
                
                switch (difficulty) {
                    case 'easy':
                        move = getRandomMove();
                        break;
                    case 'medium':
                        move = getMediumMove();
                        break;
                    case 'hard':
                        move = getBestMove();
                        break;
                    default:
                        move = getRandomMove();
                }
                
                if (move !== null) {
                    gameBoard[move] = currentPlayer;
                    const cells = document.querySelectorAll('.cell');
                    cells[move].textContent = currentPlayer;
                    cells[move].classList.add(currentPlayer.toLowerCase());
                    
                    // Check for win or draw
                    if (checkWin()) {
                        endGame(false);
                        return;
                    }
                    
                    if (checkDraw()) {
                        endGame(true);
                        return;
                    }
                    
                    // Switch player
                    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                    isPlayerTurn = true;
                    updateTurnIndicator();
                }
            }
            
            function getRandomMove() {
                const emptyCells = [];
                gameBoard.forEach((cell, index) => {
                    if (cell === '') emptyCells.push(index);
                });
                
                if (emptyCells.length === 0) return null;
                
                const randomIndex = Math.floor(Math.random() * emptyCells.length);
                return emptyCells[randomIndex];
            }
            
            function getMediumMove() {
                // Try to win if possible
                for (const pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (gameBoard[a] === currentPlayer && gameBoard[b] === currentPlayer && gameBoard[c] === '') return c;
                    if (gameBoard[a] === currentPlayer && gameBoard[c] === currentPlayer && gameBoard[b] === '') return b;
                    if (gameBoard[b] === currentPlayer && gameBoard[c] === currentPlayer && gameBoard[a] === '') return a;
                }
                
                // Block opponent from winning
                const opponent = currentPlayer === 'X' ? 'O' : 'X';
                for (const pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (gameBoard[a] === opponent && gameBoard[b] === opponent && gameBoard[c] === '') return c;
                    if (gameBoard[a] === opponent && gameBoard[c] === opponent && gameBoard[b] === '') return b;
                    if (gameBoard[b] === opponent && gameBoard[c] === opponent && gameBoard[a] === '') return a;
                }
                
                // Otherwise make a random move
                return getRandomMove();
            }
            
            function getBestMove() {
                // Minimax algorithm implementation
                function minimax(board, depth, isMaximizing) {
                    // Check for terminal states
                    if (checkWinForPlayer(board, 'O')) return 10 - depth;
                    if (checkWinForPlayer(board, 'X')) return depth - 10;
                    if (board.every(cell => cell !== '')) return 0;
                    
                    if (isMaximizing) {
                        let bestScore = -Infinity;
                        for (let i = 0; i < 9; i++) {
                            if (board[i] === '') {
                                board[i] = 'O';
                                let score = minimax(board, depth + 1, false);
                                board[i] = '';
                                bestScore = Math.max(score, bestScore);
                            }
                        }
                        return bestScore;
                    } else {
                        let bestScore = Infinity;
                        for (let i = 0; i < 9; i++) {
                            if (board[i] === '') {
                                board[i] = 'X';
                                let score = minimax(board, depth + 1, true);
                                board[i] = '';
                                bestScore = Math.min(score, bestScore);
                            }
                        }
                        return bestScore;
                    }
                }
                
                let bestMove = -1;
                let bestScore = currentPlayer === 'O' ? -Infinity : Infinity;
                
                for (let i = 0; i < 9; i++) {
                    if (gameBoard[i] === '') {
                        gameBoard[i] = currentPlayer;
                        let score = minimax(gameBoard, 0, currentPlayer === 'O');
                        gameBoard[i] = '';
                        
                        if ((currentPlayer === 'O' && score > bestScore) || 
                            (currentPlayer === 'X' && score < bestScore)) {
                            bestScore = score;
                            bestMove = i;
                        }
                    }
                }
                
                return bestMove !== -1 ? bestMove : getRandomMove();
            }
            
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6]             // diagonals
            ];
            
            function checkWinForPlayer(board, player) {
                for (const pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (board[a] === player && board[b] === player && board[c] === player) {
                        return true;
                    }
                }
                return false;
            }
            
            function checkWin() {
                return checkWinForPlayer(gameBoard, currentPlayer);
            }
            
            function checkDraw() {
                return gameBoard.every(cell => cell !== '');
            }
            
            function endGame(isDraw) {
                gameActive = false;
                
                const turnIndicator = document.getElementById('turn-indicator');
                
                if (isDraw) {
                    turnIndicator.textContent = "It's a Draw!";
                    showNotification("Game ended in a draw!", "info");
                } else {
                    let winner;
                    
                    if (gameMode === 'online') {
                        winner = currentPlayer === playerMark ? playerName : opponentName;
                    } 
                    else if (gameMode === 'vs-human') {
                        winner = currentPlayer === 'X' ? "Player 1 (X)" : "Player 2 (O)";
                    }
                    else { // vs-computer
                        winner = currentPlayer === playerMark ? "You" : "Computer";
                    }
                    
                    turnIndicator.textContent = `${winner} Wins!`;
                    showNotification(`${winner} wins!`, "success");
                }
            }
            
            function resetGame() {
                gameBoard = ['', '', '', '', '', '', '', '', ''];
                gameActive = true;
                isPlayerTurn = playerMark === 'X';
                currentPlayer = 'X';
                
                // Clear board
                const cells = document.querySelectorAll('.cell');
                cells.forEach(cell => {
                    cell.textContent = '';
                    cell.classList.remove('x', 'o');
                });
                
                // Reset turn indicator
                updateTurnIndicator();
            }
            
            function updateTurnIndicator() {
                const turnIndicator = document.getElementById('turn-indicator');
                
                if (gameMode === 'vs-computer') {
                    if (isPlayerTurn) {
                        turnIndicator.textContent = "Your Turn!";
                    } else {
                        turnIndicator.textContent = "Computer Thinking...";
                    }
                }
                else if (gameMode === 'vs-human') {
                    turnIndicator.textContent = currentPlayer === 'X' ? 
                        "Player 1's Turn (X)" : "Player 2's Turn (O)";
                }
                else { // online
                    if (currentPlayer === playerMark) {
                        turnIndicator.textContent = "Your Turn!";
                    } else {
                        turnIndicator.textContent = `${opponentName}'s Turn`;
                    }
                }
            }
        });
    </script>
</body>
</html>